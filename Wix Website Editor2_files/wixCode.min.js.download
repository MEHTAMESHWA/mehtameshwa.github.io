define("wixCode/utils/wixCodeWidgetService",["lodash","wixCodeInit"],function(a,b){"use strict";function c(a){return b.specMapUtils.getAppSpec(a)}function d(a){return!!c(a)}return{hasWixCodeWidgetSpecs:d,getWixCodeSpec:c}});define("wixCode/aspects/WixCodeWidgetAspect",["lodash","wixCodeInit","coreUtils"],function(a,b,c){"use strict";function d(a){this._aspectSiteAPI=a}d.prototype={initApp:function(){var d=this._aspectSiteAPI.getSiteData();var e=this._aspectSiteAPI.getWixCodeAppApi();var f=a.get(d,["currentUrl","query","viewerPlatformAppSources"]);var g=b.appsUtils.getAppsBaseInfo({clientSpecMap:d.getClientSpecMap(),serviceTopology:d.serviceTopology,viewerPlatformAppSources:f});var h=c.urlUtils.joinURL(d.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],"lib/wix.min.js");e.init(d,d.getClientSpecMap(),{isMobileView:d.isMobileView(),debug:d.isDebugMode(),sdkSource:a.get(d,["currentUrl","query","sdkSource"])||h,runtimeSource:a.get(d,["currentUrl","query","WixCodeRuntimeSource"]),ReactSource:a.get(d,["currentUrl","query","ReactSource"]),applications:g})}};return d});define("wixCode/handlers/wixCodeHandlers",["lodash","zepto","utils","experiment"],function(a,b,c,d){"use strict";var e=function(a){switch(a.link.type){case"PageLink":return"PAGE";case"ExternalLink":case"EmailLink":case"AnchorLink":case"DocumentLink":return"LINK"}};var f=function(b){switch(b.link.type){case"PageLink":return"/"+b.link.pageId.pageUriSEO;case"ExternalLink":return b.link.url;case"AnchorLink":var c=function(b){switch(b){case"SCROLL_TO_BOTTOM":return"#bottom";case"SCROLL_TO_TOP":return"#top";default:return a.isObject(b)?"#"+b.id:b}};var d=b.link.pageId.pageUriSEO?"/"+b.link.pageId.pageUriSEO:"";var e=b.link.anchorDataId?c(b.link.anchorDataId):"";return d+e;case"DocumentLink":return"document://"+b.link.docId;case"EmailLink":return"mailto:"+b.link.recipient}};var g=function(b){return a.map(b,function(b){var c={$type:"HEADER",title:b.label||"",children:g(b.items)};if(b.link){a.assign(c,{$type:e(b),url:f(b)})}return c})};var h=function(a,b,d){var e=c.menuUtils.getSiteMenuWithoutRenderedLinks(a.getSiteData(),false);d(g(e))};var i=function(a,b){return a.getSiteData().findDataOnMasterPageByPredicate(function(a){return a.pageUriSEO===b||a.id===b})};var j=function(a,b){var c=a.getSiteData();var d=c.renderFlags.isExternalNavigationAllowed;if(!b||!d){var e=c.renderRealtimeConfig.previewTooltipCallback;e(k(50,20),"text_editor_inactive_link_on_preview");return}window.location.href=b};var k=function(a,b){var c=window.screenLeft!==undefined?window.screenLeft:window.screen.left;var d=window.screenTop!==undefined?window.screenTop:window.screen.top;var e;var f;if(window.innerWidth){e=window.innerWidth}else{e=window.document.documentElement.clientWidth?window.document.documentElement.clientWidth:window.screen.width}if(window.innerHeight){f=window.innerHeight}else{f=window.document.documentElement.clientHeight?window.document.documentElement.clientHeight:window.screen.height}var g=e/2-a/2+c;var h=f/2-b/2+d;return{top:h,left:g}};var l=function(b,c){if(c.data.type==="ExternalLink"){j(b,c.data.url);return}var e={pageId:b.getSiteData().getPrimaryPageId()};if(c.data.pageId){if(c.data.pageId==="#"){a.assign(e,{pageId:b.getSiteData().getMainPageId()})}else{var f=i(b,c.data.pageId);a.assign(e,{pageId:f.id==="masterPage"?e.pageId:f.id})}}if(c.data.anchorDataId){a.assign(e,{anchorData:c.data.anchorDataId})}if(c.data.routerId&&d.isOpen("sv_dpages")){var g=a.get(b.getSiteData(),["routers","configMap",c.data.routerId]);var h=c.data.innerRoute?g.prefix+"/"+c.data.innerRoute:g.prefix;if(g){e={routerDefinition:g,innerRoute:c.data.innerRoute,pageAdditionalData:h}}}b.handleNavigation(e,"#",true)};var m=function(a,b,c){c({window:a.getWindowSize(),scroll:a.getSiteScroll(),document:a.getDocumentSize()})};var n=function(a,b,c){var d=a.getComponentById(b.data.compId);d.uploadFiles(c)};var o=function(a,b){var c=b.data;var d=a.getSiteAspect("HtmlPostMessageAspect");d.postMessage(c.id,c.msg)};var p=function(a,b,c){var d=b.data.id;var e=a.getSiteAspect("PopupPageAspect");if("context"in b.data){a.getRuntimeDal().setPopupContext(d,b.data.context)}if(c){e.registerCloseHandler(d,c)}e.openPopupPage(d)};var q=function(a,b){var c=b.data.id;if(a.getCurrentPopupId()!==c){return}a.getSiteAspect("PopupPageAspect").closePopupPage(b.data.returnedData)};var r=function(a,b){a.reportBI(b.reportDef,b.params)};var s=function(b,d,e){var f=b.getSiteData();var g=a.find(f.routers.configMap,{prefix:d.data.prefix})||{};var h=c.routersBackEndRequests.makeParamObjFromSiteData(f,g);c.routersBackEndRequests.getInnerRoutesSiteMap(h,function(a){e(a)},a.noop)};var t=function(b,c,d){window.navigator.geolocation.getCurrentPosition(function(b){d({timestamp:a.get(b,"timestamp"),coords:a.toPlainObject(a.get(b,"coords"))})},function(a){d(null,a&&a.message)})};return{reportBI:r,windowBoundingRect:m,navigateTo:l,postHtmlMessage:o,getSiteMenu:h,openLightbox:p,closeLightbox:q,getRoutersSiteMap:s,startFileUpload:n,getCurrentGeolocation:t}});define("wixCode/services/platformTpaApiService",["lodash"],function(a){"use strict";var b={};var c;function d(){if(a.size(b)>0){a.forEach(b,function(b,d){var g=c.getComponentById(d.id).getIframe();f({intent:"PLATFORM_TPA_PUBLIC_API",compId:a.get(d.props,"id"),method:b.msg.data.fn,args:b.msg.data.fnArgs},g.contentWindow,b.callback);e(d)})}}function e(a){delete b[a]}function f(a,b,c){var d=new MessageChannel;b.postMessage(a,"*",[d.port2]);d.port1.onmessage=function(a){c(a.data)}}function g(a,e,g,h){c=a;var i=e.getIframe();if(i){d(b);f({intent:"PLATFORM_TPA_PUBLIC_API",compId:e.props.id,method:g.data.fn,args:g.data.fnArgs},i.contentWindow,h)}else{b[e]={msg:g,callback:h}}}return{invokeApi:g}});define("wixCode/utils/constants",[],function(){"use strict";return{MESSAGE_INTENT:{WIX_CODE_MESSAGE:"WIX_CODE",WIX_CODE_SITE_API:"WIX_CODE_SITE_API",WIX_CODE_APP_API:"WIX_CODE_APP_API"},MESSAGE_TYPE:{CONSOLE:"console",IFRAME_COMMAND:"wix_code_iframe_command",GOOGLE_ANALYTICS:"googleAnalytics"}}});define("wixCode/services/wixCodeUserScriptsService",["lodash","coreUtils"],function(a,b){"use strict";var c=b.urlUtils;var d="pages";function e(b,c){var e=a.get(c,"wixCode.fileCacheKillers",{});var f=a.get(c,"wixCode.defaultFileCacheKiller");var g="public/"+d+"/"+b;var h=e[g];if(h){return h}return f}function f(){return"https:"}function g(a,b,g,h,i){var j=f()+"//"+h.extensionId+"."+i.serviceTopology.wixCloudBaseDomain;var k=c.joinURL(j,d,a);return k+"?empty-if-missing=true"+"&exclude=wix-"+"&module-name="+b+"&viewMode="+i.viewMode+"&instance="+h.instance+"&scari="+g.signedAppRenderInfo+"&cacheKiller="+e(a,i)}function h(a,b,e,g,h){var i="v2";var j=f()+"//"+g.extensionId+".static."+h.serviceTopology.wixCloudBaseDomain;var k=c.joinURL(j,"static",i,e.appData.codeAppId,g.instanceId,d,a);return k+"?empty-if-missing=true"+"&exclude=wix-"+"&module-name="+b}function i(a,b,c,d,e){return e.viewMode==="site"?h(a,b,c,d,e):g(a,b,c,d,e)}function j(a){return a.type==="masterPage"?"site":a.displayName+" "+(a.type==="Popup"?"popup":"page")}function k(a,b,c,d){var e=a.type==="masterPage"?"masterPage":a.id;var f=e+".js";return{url:i(f,e,b,c,d),displayName:j(a),scriptName:f}}return{getUserScript:k}});define("wixCode/utils/messageBuilder",["lodash","wixCode/services/wixCodeUserScriptsService","wixCode/utils/constants"],function(a,b,c){"use strict";function d(a,c,d,e,f){if(a.type==="load_widgets"||a.type==="load_user_code"){var g={appConfig:{scari:d.signedAppRenderInfo}};if(c.type!=="Application"){g.appConfig.userScript=b.getUserScript(c,d,e,f)}return g}}function e(a){return a.type!=="Application"||a.id==="dataBinding"}function f(b,f,g,h){var i={intent:c.MESSAGE_INTENT.WIX_CODE_MESSAGE};if(g&&b.widgets){b.widgets=a.map(b.widgets,function(c){return e(c)?a.assign({},c,d(b,c,f,g,h)):c})}return a.defaults({},b,i)}return{getExtendedMessage:f}});define("wixCode/aspects/wixCodePostMessageService",["lodash","tpa","utils","wixCode/handlers/wixCodeHandlers","wixCode/services/platformTpaApiService","wixCode/utils/constants","wixCode/utils/messageBuilder","wixCode/utils/wixCodeWidgetService","widgets"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){return a===f.MESSAGE_INTENT.WIX_CODE_MESSAGE}function k(a){return a===f.MESSAGE_INTENT.WIX_CODE_SITE_API}function l(a){return a===f.MESSAGE_INTENT.WIX_CODE_APP_API}function m(a){return i.widgetService.getWidgetHandler(a)}function n(a,b,d){var e=m(a);switch(b.type){case f.MESSAGE_TYPE.IFRAME_COMMAND:e.onCommand(b,d);break;case f.MESSAGE_TYPE.CONSOLE:c.logWixCodeConsoleMessage(b);break;case f.MESSAGE_TYPE.GOOGLE_ANALYTICS:c.logger.reportGoogleAnalytics.apply(null,[a.getSiteData()].concat(b.data));break;default:e.handleRemoteMessage(b);break}}function o(b,c,d){var f=a.get(c.data,"compId");var g=b.getComponentById(f);if(g){switch(c.type){case"invokeAppFn":e.invokeApi(b,g,c,d);break;default:break}}else{throw new Error("No component found for message",c.data)}}function p(c,e,f){try{if(a.isString(e)){e=JSON.parse(e)}}catch(a){return}if(e){var g;if(j(e.intent)){f(e,q(e,m(c)))}else if(k(e.intent)){var h=a.assign({},b.tpaHandlers,d);g=q(e,m(c));if(h[e.type]){try{h[e.type](c,e,g)}catch(a){g(null,a.message)}}}else if(l(e.intent)){g=q(e,m(c));try{o(c,e,g)}catch(a){g(null,a.message)}}}}function q(b,c){return function(d,e){var f={intent:"WIX_CODE_RESPONSE",callbackId:b.callbackId,type:b.type,contextId:b.contextId};if(k(b.intent)||l(b.intent)){f=a.merge(f,a.omitBy({result:d,error:e},a.isUndefined))}else{f=a.merge(f,a.omitBy({result:{compName:b.compName,command:b.command}},a.isUndefined))}try{c.updateComponent(f)}catch(a){}}}function r(b,c,d){p(b,c,d||a.partial(n,b))}function s(a,b){var c=a.getSiteData();var d=c.rendererModel.wixCodeModel;var e=h.getWixCodeSpec(c.rendererModel.clientSpecMap);return g.getExtendedMessage(b,d,e,c)}function t(b,c){i.widgetService.registerWidgetMessageHandler(b,a.partial(c,b))}function u(b,c){i.widgetService.registerWidgetMessageModifier(b,a.partial(c,b))}return{handleMessage:r,modifyPostMessage:s,registerMessageHandler:t,registerMessageModifier:u}});define("wixCode/aspects/WixCodePostMessageAspect",["wixCode/aspects/wixCodePostMessageService"],function(a){"use strict";return function b(c){this.siteAPI=c;a.registerMessageHandler(this.siteAPI,a.handleMessage);a.registerMessageModifier(this.siteAPI,a.modifyPostMessage)}});define("wixCode/aspects/wixCodeAspectCollector",["core","wixCode/aspects/WixCodeWidgetAspect","wixCode/aspects/WixCodePostMessageAspect"],function(a,b,c){"use strict";var d=a.siteAspectsRegistry;d.registerSiteAspect("wixCodeWidgetAspect",b);d.registerSiteAspect("wixCodePostMessageAspect",c)});define("wixCode/utils/kibanaReporter",["lodash","utils"],function a(b,c){"use strict";var d={INFO:"info",ERROR:"error"};function e(a,b){var d=f(a);var e={protocol:"http:",hostname:"monitoringhub."+b,path:"/logstash/events/gost",query:d,hash:""};var g=c.urlUtils.buildFullUrl(e);if(typeof window!=="undefined"){var h=new window.Image(0,0);h.src=g}}function f(a){var c=b.clone(a);if(b.isError(c.message)){c.message=c.message.stack}if(c.hasOwnProperty("message")&&!b.isString(c.message)){c.message=JSON.stringify(c.message)}var d={message:512};b.forEach(d,function(d,e){if(b.isString(a[e])){c[e]=c[e].substr(0,Math.min(c[e].length,d))}});return c}function g(){return{source:"wix-code-client",level:d.INFO,userActionId:c.guidUtils.getGUID()}}function h(a){if(!b.isString(a)||a.length===0){throw new Error("parameter `baseDomain` is invalid, received: "+a)}}function i(a,c){h(c);var d=new Date;var f=d.getTime();var i=b.assign({},g(),a,{timestamp:d.toJSON(),actionPosition:"start"});e(i,c);return function(a){var d=new Date;var g=d.getTime();var h=(g-f)/1e3;a=b.assign({},i,a,{timestamp:d.toJSON(),duration:h,actionPosition:"end"});e(a,c)}}return{levels:d,trace:i}});define("wixCode",["wixCode/utils/wixCodeWidgetService","wixCode/aspects/wixCodeAspectCollector","wixCode/utils/messageBuilder","wixCode/utils/kibanaReporter","wixCode/aspects/wixCodePostMessageService"],function(a,b,c,d,e){"use strict";return{wixCodeWidgetService:a,log:d,messageBuilder:c,wixCodePostMessageService:e}});